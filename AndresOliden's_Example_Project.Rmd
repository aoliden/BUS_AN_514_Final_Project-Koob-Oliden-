---
title: "AndresOliden's_Example_Project"
author: "Andres Oliden"
date: "10/14/2019"
output: 
  tufte::tufte_html:
    tufte_variant: "envisioned"
    highlight: pygments
    css: ../lab.css
link-citations: yes
---

```{r include=FALSE}
library(tufte)
library(knitr)
options(
  htmltools.dir.version = FALSE, # for blogdown
  show.signif.stars = FALSE,     # for regression output
  digits = 2
  )
knitr::opts_chunk$set(eval = TRUE)
```

```{r fig.margin=TRUE, eval=TRUE, echo=FALSE}
include_graphics("img/mitch-hedgeberg-lqd.jpg")
```

# Packages

In this lab we will use the `tidyverse` package.

```{r eval = TRUE}
library(tidyverse) 
```


# The data

The data consist of two csv (comma separated values) files: one for 
Denny's locations and the other for La Quinta.

```{r load-data-for-show, include=FALSE}
dn <- read_csv("../data/dennys.csv")
lq <- read_csv("../data/laquinta.csv")
```

```{r, include=TRUE}
dn <- read_csv("../data/dennys.csv")
lq <- read_csv("../data/laquinta.csv")
```

# Exercises

1. Filter the Denny's dataframe for Alaska (AK) and save the result as 
   `dn_ak`. How many Denny's locations are there in Alaska?
   
```{r}
dn_ak <- dn %>%
  filter(state == "AK")
nrow(dn_ak)
```

2. Filter the La Quinta dataframe for Alaska (AK) and save the result 
   as `lq_ak`. How many La Quinta locations are there in Alaska?
   
```{r}
lq_ak <- lq %>%
  filter(state == "AK")
nrow(lq_ak)
```

Next we'll calculate the distance between all Denny's and all La Quinta 
locations in Alaska. Let's take this step by step:

**Step 1:** There are 3 Denny's and 2 La Quinta locations in Alaska. 
(If you answered differently above, you might want to recheck your answers.)

![](img/dennys-laquinta-sketches/dennys-laquinta-sketches.001.png){width=300px height=300px}

**Step 2:** Let's focus on the first Denny's location. We'll need to 
calculate two distances for it: (1) distance between Denny's 1 and 
La Quinta 1 and (2) distance between Denny's 1 and La Quinta (2).

![](img/dennys-laquinta-sketches/dennys-laquinta-sketches.002.png){width=300px height=150px}

**Step 3:** Now let's consider all Denny's locations.

![](img/dennys-laquinta-sketches/dennys-laquinta-sketches.003.png){width=300px height=450px}

3. How many pairings are there between all Denny's and all La Quinta locations
   in Alaska, i.e. how many distances do we need to calculate between the 
   locations of these establishments in Alaska?
   
      - **There are six total pairings between the Denny's and La Quinta's locations; therefore we need to calculate a total of 6 distances** 

In order to calculate these distances we need to first restructure our data 
to pair the Denny's and La Quinta locations. To do so, we will join the two 
data frames. We have six join options in R. Each of these join functions take 
at least three arguments: `x`, `y`, and `by`.

- `x` and `y` are data frames to join
- `by` is the variable(s) to join by

Four of these join functions combine variables from the two data frames:

```{marginfigure}
These are called **mutating joins**.
```

- `inner_join()`: return all rows from `x` where there are matching values 
in `y`, and all columns from `x` and `y`.

- `left_join()`: return all rows from `x`, and all columns from `x` and `y`. 
Rows in x with no match in y will have NA values in the new columns.

- `right_join()`: return all rows from `y`, and all columns from `x` and `y`. 
Rows in y with no match in x will have NA values in the new columns.

- `full_join()`: return all rows and all columns from both `x` and `y`. Where 
there are not matching values, returns NA for the one missing.

And the other two join functions only keep cases from the left-hand data frame, 
and are called **filtering joins**. We'll learn about these another time but 
you can find out more about the join functions in the help files for any one 
of them, e.g. `?full_join`.

In practice we mostly use mutating joins. In this case we want to keep all 
rows and columns from both `dn_ak` and `lq_ak` data frames. So we will use 
a `full_join`.

![Full join of Denny's and La Quinta locations in AK](img/dennys-laquinta-sketches/dennys-laquinta-sketches.004.png){height=300px width=300px}

Let's join the data on Denny's and La Quinta locations in Alaska, and take 
a look at what it looks like:

```{r}
dn_lq_ak <- full_join(dn_ak, lq_ak, by = "state")
dn_lq_ak
```

4. How many observations are in the joined `dn_lq_ak` data frame? What are 
   the names of the variables in this data frame. 
   
`.x` in the variable names means the variable comes from the `x` data frame 
(the first argument in the `full_join` call, i.e. `dn_ak`), and `.y` means 
the variable comes from the `y` data frame. These varibles are renamed to 
include `.x` and `.y` because the two data frames have the same variables 
and it's not possible to have two variables in a data frame with the exact 
same name.

```{r}
NROW(dn_lq_ak)
NCOL(dn_lq_ak)
dim(dn_lq_ak)

library(dplyr)
glimpse(dn_lq_ak)
```


Now that we have the data in the format we wanted, all that is left is to 
calculate the distances between the pairs.

5.  What function from the tidyverse do we use the add a new variable to 
    a data frame while keeping the existing variables?

One way of calculating the distance between any two points on the earth is 
to use the Haversine distance formula. This formula takes into account the 
fact that the earth is not flat, but instead spherical.

This function is not available in R, but we have it saved in a file called 
`haversine.R` that we can load and then use:

```{r}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 = long1 * pi / 180
  lat1  = lat1  * pi / 180
  long2 = long2 * pi / 180
  lat2  = lat2  * pi / 180
  
  R = 6371 # Earth mean radius in km
  
  a = sin((lat2 - lat1)/2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1)/2)^2
  d = R * 2 * asin(sqrt(a))
  
  return( round(d,round) ) # distance in km
}
```

This function takes five arguments:

- Longitude and latitude of the first location
- Longitude and latitude of the second location
- A parameter by which to round the responses

6. Calculate the distances between all pairs of Denny's and La Quinta 
   locations and save this variable as `distance`. Make sure to save this variable 
   in THE `dn_lq_ak` data frame so that you can use it later.
   
```{r}
dn_lq_ak <- dn_lq_ak %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))

glimpse(dn_lq_ak)
```


7. Calculate the minimum distance between a Denny's and La Quinta for each Denny's 
   location. To do so we group by Denny's locations and calculate a new variable 
   that stores the information for the minimum distance.

```{r}
dn_lq_ak_mindist <- dn_lq_ak %>%
  group_by(address.x) %>%
  summarise(closest = min(distance))

glimpse(dn_lq_ak)
```

8. Describe the distribution of the distances Denny's and the nearest La Quinta 
   locations in Alaska. Also include an appripriate visualization and 
   relevant summary statistics. 

```{r}
ggplot(dn_lq_ak_mindist, aes(x = address.x, y = closest)) + 
    geom_col()

dn_lq_ak_mindist %>%
    summarise(min = min(closest),
              max = max(closest),
              mean = mean(closest),
              sd = sd(closest))

```

9. Repeat the same analysis for North Carolina: (i) filter Denny's and 
   La Quinta Data Frames for NC, (ii) join these data frames to get a complete
   list of all possible pairings, (iii) calculate the distances between all 
   possible pairings of Denny's and La Quinta in NC, (iv) find the minimum distance 
   between each Denny's and La Quinta location, (v) visualize and 
   describe the distribution of these shortest distances using appropriate summary 
   statistics.

**NORTH CAROLINA**

```{r}
dn_NC <- dn %>%
  filter(state == "NC")
nrow(dn_NC)

lq_NC <- lq %>%
  filter(state == "NC")
nrow(lq_NC)

dn_lq_NC <- full_join(dn_NC, lq_NC, by = "state")
dn_lq_NC

dn_lq_NC <- dn_lq_NC %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))

dn_lq_NC_mindist <- dn_lq_NC %>%
  group_by(address.x) %>%
  summarise(closest = min(distance))

ggplot(dn_lq_NC_mindist, aes(x = address.x, y = closest)) + 
    geom_col()

dn_lq_NC_mindist %>%
    summarise(min = min(closest),
              max = max(closest),
              mean = mean(closest),
              sd = sd(closest))


glimpse(dn_lq_NC)
```

10. Repeat the same analysis for Texas.

**TEXAS**

```{r}
dn_TX <- dn %>%
  filter(state == "TX")
nrow(dn_TX)

lq_TX <- lq %>%
  filter(state == "TX")
nrow(lq_TX)

dn_lq_TX <- full_join(dn_TX, lq_TX, by = "state")
dn_lq_TX

dn_lq_TX <- dn_lq_TX %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))

dn_lq_TX_mindist <- dn_lq_TX %>%
  group_by(address.x) %>%
  summarise(closest = min(distance))

ggplot(dn_lq_TX_mindist, aes(x = address.x, y = closest)) + 
    geom_col()

dn_lq_TX_mindist %>%
    summarise(min = min(closest),
              max = max(closest),
              mean = mean(closest),
              sd = sd(closest))


glimpse(dn_lq_TX)
```

11. Repeat the same analysis for a state of your choosing, different than the 
    ones we covered so far.

**MONTANTA**

```{r}
dn_MT <- dn %>%
  filter(state == "MT")
nrow(dn_MT)

lq_MT <- lq %>%
  filter(state == "MT")
nrow(lq_MT)

dn_lq_MT <- full_join(dn_MT, lq_MT, by = "state")
dn_lq_MT

dn_lq_MT <- dn_lq_MT %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))

dn_lq_MT_mindist <- dn_lq_MT %>%
  group_by(address.x) %>%
  summarise(closest = min(distance))

ggplot(dn_lq_MT_mindist, aes(x = address.x, y = closest)) + 
    geom_col()

dn_lq_MT_mindist %>%
    summarise(min = min(closest),
              max = max(closest),
              mean = mean(closest),
              sd = sd(closest))


glimpse(dn_lq_MT)
```
    
12. Among the states you examined, where is Mitch Hedberg's joke most likely 
    to hold true? Explain your reasoning.

        - In the questions above, I was able to examine North Carolina, Texas, 
        and Montana. A brief summary of their information can be found below:
        
            - **North Carolina**
            
            min = *1.78*   
            
            max = *188*  
            
            mean = *65.4*   
            
            sd = *53.4*
            
            
            
            - **Texas**
            
            min = *0.016*     
            
            max = *60.6*  
            
            mean = *5.79*   
            
            sd = *8.83*
            
            
            - ** Montana**
            
            min = *0.955*  
            
            max = *7.59* 
            
            mean = *4.89*      
            
            sd = *2.82*   
               
        - *It can be easily seen that in states like Texas and Montana that 
        Mitch Hedberg’s joke hold true; on average, locations are within 5 
        from each other. From North Carolina's persepctive, we can see that 
        the joke does not hold true. On average, the locations are 65 
        miles from each other.* 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
